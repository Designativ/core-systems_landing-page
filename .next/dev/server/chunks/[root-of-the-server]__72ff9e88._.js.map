{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/nataliiaivanova/Documents/Core-Design/Website%202.0/src/app/api/contact/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { Resend } from \"resend\";\n\n// Lazy initialization to avoid errors at module load time\nfunction getResendClient() {\n  try {\n    const apiKey = process.env.RESEND_API_KEY;\n    if (!apiKey) {\n      return null;\n    }\n    return new Resend(apiKey);\n  } catch (error) {\n    console.error(\"Failed to initialize Resend client:\", error);\n    return null;\n  }\n}\n\nexport async function POST(request: Request) {\n  // Ensure we always return JSON with proper headers\n  const jsonHeaders = {\n    \"Content-Type\": \"application/json\",\n  };\n\n  try {\n    // Parse request body with error handling\n    let body;\n    try {\n      body = await request.json();\n    } catch (parseError) {\n      console.error(\"Error parsing request body:\", parseError);\n      return NextResponse.json(\n        { error: \"Invalid request format. Please ensure all fields are properly filled.\" },\n        { status: 400, headers: jsonHeaders }\n      );\n    }\n\n    const { name, email, company, website, message, recaptchaToken } = body;\n\n    // Validate required fields\n    if (!name || !email || !message) {\n      return NextResponse.json(\n        { error: \"Name, email, and message are required\" },\n        { status: 400, headers: jsonHeaders }\n      );\n    }\n\n    // Validate email format\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      return NextResponse.json(\n        { error: \"Invalid email address\" },\n        { status: 400, headers: jsonHeaders }\n      );\n    }\n\n    // Verify reCAPTCHA token (if configured)\n    // Skip reCAPTCHA verification in development/localhost if not configured\n    const isDevelopment = process.env.NODE_ENV === \"development\" || \n                         request.headers.get(\"host\")?.includes(\"localhost\");\n    \n    if (process.env.RECAPTCHA_SECRET_KEY) {\n      if (!recaptchaToken) {\n        // In development, allow submission without reCAPTCHA if it's not working\n        if (isDevelopment) {\n          console.warn(\"reCAPTCHA token missing in development - allowing submission without verification\");\n        } else {\n          return NextResponse.json(\n            { error: \"reCAPTCHA verification failed. Please refresh the page and try again.\" },\n            { status: 400, headers: jsonHeaders }\n          );\n        }\n      } else {\n        try {\n          const recaptchaResponse = await fetch(\n            \"https://www.google.com/recaptcha/api/siteverify\",\n            {\n              method: \"POST\",\n              headers: {\n                \"Content-Type\": \"application/x-www-form-urlencoded\",\n              },\n              body: `secret=${process.env.RECAPTCHA_SECRET_KEY}&response=${recaptchaToken}`,\n            }\n          );\n\n          const recaptchaData = await recaptchaResponse.json();\n\n          if (!recaptchaData.success) {\n            console.error(\"reCAPTCHA verification failed:\", recaptchaData);\n            \n            // In development, allow submission even if reCAPTCHA fails (for testing)\n            if (isDevelopment) {\n              console.warn(\"reCAPTCHA verification failed in development - allowing submission for testing\");\n            } else {\n              // Check for specific error codes\n              const errorCodes = recaptchaData[\"error-codes\"] || [];\n              let errorMessage = \"reCAPTCHA verification failed. Please try again.\";\n              \n              if (errorCodes.includes(\"invalid-input-secret\") || errorCodes.includes(\"missing-input-secret\")) {\n                errorMessage = \"reCAPTCHA configuration error. Please contact support.\";\n              } else if (errorCodes.includes(\"timeout-or-duplicate\")) {\n                errorMessage = \"reCAPTCHA token expired. Please refresh and try again.\";\n              }\n              \n              return NextResponse.json(\n                { error: errorMessage },\n                { status: 400, headers: jsonHeaders }\n              );\n            }\n          } else {\n            // Optional: Check score (reCAPTCHA v3 returns a score from 0.0 to 1.0)\n            // Lower scores indicate a bot, higher scores indicate a human\n            if (recaptchaData.score && recaptchaData.score < 0.5) {\n              console.warn(\"reCAPTCHA score is low:\", recaptchaData.score);\n              // In development, allow low scores for testing\n              if (!isDevelopment) {\n                // In production, you might want to flag or reject low scores\n                // For now, we'll allow but log it\n              }\n            }\n          }\n        } catch (recaptchaError) {\n          console.error(\"Error verifying reCAPTCHA:\", recaptchaError);\n          // In development, allow submission even if reCAPTCHA verification fails\n          if (isDevelopment) {\n            console.warn(\"reCAPTCHA verification error in development - allowing submission for testing\");\n          } else {\n            return NextResponse.json(\n              { error: \"reCAPTCHA verification error. Please try again.\" },\n              { status: 500, headers: jsonHeaders }\n            );\n          }\n        }\n      }\n    } else {\n      // If reCAPTCHA is not configured, log a warning but allow the submission\n      if (isDevelopment) {\n        console.log(\"reCAPTCHA is not configured - form will work without spam protection\");\n      } else {\n        console.warn(\"RECAPTCHA_SECRET_KEY is not configured. reCAPTCHA verification is disabled.\");\n      }\n    }\n\n    // Check if RESEND_API_KEY is configured and initialize client\n    const resend = getResendClient();\n    if (!resend) {\n      console.error(\"RESEND_API_KEY is not configured. Please add it to .env.local\");\n      return NextResponse.json(\n        { error: \"Email service is not configured. Please set RESEND_API_KEY in .env.local\" },\n        { status: 500, headers: jsonHeaders }\n      );\n    }\n\n    // Prepare email content\n    const emailSubject = `New Contact Form Submission from ${name}`;\n    const emailHtml = `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>New Contact Form Submission</title>\n        </head>\n        <body style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n          <h2 style=\"color: #333; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px;\">\n            New Contact Form Submission\n          </h2>\n          \n          <div style=\"background-color: #f9fafb; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n            <p><strong>Name:</strong> ${name}</p>\n            <p><strong>Email:</strong> <a href=\"mailto:${email}\" style=\"color: #2563eb;\">${email}</a></p>\n            ${company ? `<p><strong>Company:</strong> ${company}</p>` : ''}\n            ${website ? `<p><strong>Website:</strong> <a href=\"${website}\" target=\"_blank\" style=\"color: #2563eb;\">${website}</a></p>` : ''}\n          </div>\n          \n          <div style=\"margin: 20px 0;\">\n            <h3 style=\"color: #333; margin-bottom: 10px;\">Message:</h3>\n            <div style=\"background-color: #ffffff; padding: 15px; border-left: 4px solid #10b981; border-radius: 4px; white-space: pre-wrap;\">\n              ${message}\n            </div>\n          </div>\n          \n          <hr style=\"border: none; border-top: 1px solid #e5e7eb; margin: 30px 0;\">\n          \n          <p style=\"color: #6b7280; font-size: 14px;\">\n            This email was sent from the contact form on your website.<br>\n            Timestamp: ${new Date().toLocaleString()}\n          </p>\n        </body>\n      </html>\n    `;\n\n    const emailText = `\nNew Contact Form Submission\n\nName: ${name}\nEmail: ${email}\n${company ? `Company: ${company}` : ''}\n${website ? `Website: ${website}` : ''}\n\nMessage:\n${message}\n\n---\nThis email was sent from the contact form on your website.\nTimestamp: ${new Date().toLocaleString()}\n    `.trim();\n\n    // Send email using Resend\n    const { data, error } = await resend.emails.send({\n      from: process.env.RESEND_FROM_EMAIL || \"onboarding@resend.dev\",\n      to: \"natalieindesign@gmail.com\",\n      replyTo: email,\n      subject: emailSubject,\n      html: emailHtml,\n      text: emailText,\n    });\n\n    if (error) {\n      console.error(\"Resend API error:\", error);\n      return NextResponse.json(\n        { error: `Failed to send email: ${error.message || JSON.stringify(error)}` },\n        { status: 500, headers: jsonHeaders }\n      );\n    }\n\n    console.log(\"Email sent successfully:\", data);\n\n    return NextResponse.json(\n      { message: \"Form submitted successfully\", id: data?.id },\n      { status: 200, headers: jsonHeaders }\n    );\n  } catch (error) {\n    // Catch any unhandled errors and ensure we always return JSON\n    console.error(\"Error processing contact form:\", error);\n    const errorMessage = error instanceof Error ? error.message : \"Unknown error\";\n    \n    // Safely extract error details\n    let errorDetails = \"Failed to process form submission\";\n    if (error instanceof Error) {\n      errorDetails = error.message || errorDetails;\n    }\n    \n    // Ensure we always return JSON, never HTML\n    try {\n    return NextResponse.json(\n        { error: errorDetails },\n        { status: 500, headers: jsonHeaders }\n      );\n    } catch (jsonError) {\n      // Last resort - return a basic JSON error if even JSON creation fails\n      console.error(\"Critical: Failed to create JSON response:\", jsonError);\n      return new Response(\n        JSON.stringify({ error: \"Internal server error\" }),\n        {\n          status: 500,\n          headers: jsonHeaders,\n        }\n      );\n    }\n  }\n}\n"],"names":[],"mappings":"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"}}]
}